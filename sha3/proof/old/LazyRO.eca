require import Option FSet NewFMap.
require (*..*) NewROM.

type from, to.
op d: to distr.

clone include NewROM with
  type from  <- from,
  type to    <- to,
  op dsample <- fun (x:from) => d.


module H = {
  var m : (from, to) fmap

  proc init() = { m = map0; }

  proc f(x) = {
    if (!mem (dom m) x) m.[x] = $d;
    return oget m.[x];
  }
}.
